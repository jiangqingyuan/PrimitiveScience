# Code Quality

· 代码质量有很多方面。我们可以说高效的代码，也就是运行速度快或者不浪费内存等资源的代码。它也可以是我们人类易于阅读和理解的源代码，因此易于阅读和维护。本章中，我们将讨论这个问题，并看看编写高质量代码的一些最佳实践。
我们还将看一些例子，如果我们想编写高质量的代码，我们应该尽量避免的事情。

Before we learn how to write quality code, we should define what code quality is.

Understanding what code quality is
Writing readable code
Writing efficient code
Understanding that smart code is not always smart
Understanding some of the best practices for writing quality code

当涉及到程序代码时，很难定义质量的含义。原因是，所有开发人员都会对它的含义有自己的看法。一位开发人员可能会争辩说，我们应该专注于编写可读代码，因为这样更容易理解和维护，从而减少我们在代码中插入任何错误的机会。另一位开发人员可能会争辩说，我们应该专注于编写紧凑的代码；也就是说，尽可能少地编写代码行。即使代码更难读，更少的代码也会减少在代码中引入错误的机会。
在这里，这两个开发人员会主张相同的事情-减少代码中的错误-具有两个相互矛盾的立场。
但谁是对的--是开发人员主张可读性，还是主张减少代码？我们不能说，因为他们都是对的。
我们需要的是更好地定义什么是代码质量，**更重要的是，它应该是可衡量的。**
为了定义一个衡量代码质量的模型，已经做了很多努力，其中一个更著名的是CisQ的质量模型。我们拭目以待，看看接下来会发生什么。

· CISQ质量模型
Information Software Quality（CISQ）定义了五条规则，可用于度量代码的质量。它最初被定义为商业软件，但后来扩展到包括嵌入式系统，主要用于物联网（IoT）应用。这些规则如下：
可靠性：可靠性衡量风险等级和失败的可能性。它还将度量在更新或修改现有代码时注入到其中的缺陷。度量可靠性的目标是防止应用程序由于严重的错误而无法运行。
性能效率：当应用程序运行时，它执行操作的速度取决于代码的编写和结构。在代码级别上测量效率将有助于提高应用程序的总体响应时间，以及我们如何识别需要高速处理数据的应用程序的潜在风险，这些应用程序由于处理数据的速度不够快而失败。
安全性：安全性规则将衡量由于不良的编码实践而导致的潜在安全漏洞的可能性。
可维护性：当我们在讨论代码的可维护性时，通常指的是三件事。我们说代码应该是，换句话说，可适应的，这是代码，我们可以适应每一个需求的变化；可移植的，也就是可以在不同平台上使用的代码，比如不同的操作系统；以及可转移的，也就是可以从一个开发团队转移到另一个开发团队的代码。

· 这或多或少可以应用于所有的代码，但我们希望能够尽可能少地完成这三项工作。
大小：大小本身不是一个质量属性，但是代码的大小会对其可维护性产生影响。我们拥有的代码越多，就越难导航、理解和遵循它的逻辑。
我们现在已经讨论了关于代码的质量方面。但是，从用户的角度来看，质量又如何呢？

了解用户质量。
从用户的角度来看，CIQ模型很少关注质量。一个应用程序可以匹配所有的CISQ规则，但是该应用程序的用户可能仍然认为它的质量很差。
美国软件工程师汤姆·德马科博士提出，一个产品的质量取决于它在多大程度上让世界变得更好。
这句话可以解释为，应用程序的功能质量和用户满意度比代码的结构质量更重要。
美国计算机科学家杰拉尔德·温伯格曾说过，
质量对某些人来说是有价值的。这意味着质量是主观的--一个人在应用程序中定义的质量可能与另一个人的定义相反。这一观点将集中于提出这样的问题：谁是想要重视我们软件的人？对他们来说，什么将是有价值的？

有了这些定义，我们就会开始意识到，制作软件不仅仅是编写代码。即使代码质量很好，如果用户不喜欢我们创建的东西，他们也不会使用它。这就像我们用最好的工艺制作了一把椅子，但如果它令人难以置信地不舒服，没有人会买它。

因此，我们必须了解我们的用户和他们的需求。要做到这一点并不总是那么容易，因为我们的潜在用户可能不知道这些需求。
在你拥有第一部智能手机之前，你不会错过它，因为你不知道它能为你提供什么。现在，另一方面，如果它被从你身边拿走，你会在几个小时后错过它。
为了在用户理解之前了解他们的需求，我们需要使用我们的想象力。我们可以从问一些简单的问题开始。他们可能是，这个应用程序将解决什么问题？谁将从中受益？使用此应用程序的受益者有没有共同的模式？这个群体已经在使用什么类型的应用程序？我们是否可以在应用程序中重用这些应用程序中使用的功能、模式或想法，以使这组人从一开始就更熟悉我们的应用程序的工作方式？

· 当我们知道谁是我们未来的用户时，我们需要关注应用程序中的流程。我们都知道这是多么令人沮丧，当我们使用一个程序，或任何其他产品的问题，我们不知道该怎么做。我们一个接一个地尝试，很快，我们就失去了使用它的兴趣。
如果你投入时间和金钱去开发某样东西，你至少应该给你的伟大想法每一个成功的机会。
太好了！我们现在对什么是代码质量有了一个概念，我们也从用户的角度理解了质量方面。我相信你想在你的软件都，所以让我们把他们放在一起。

· 把它们放在一起
如果我们仔细想想，创建高质量软件的艺术当然既不是编写高质量的代码，也不是编写用户认为有价值的应用程序;两者兼而有之。

正如我们在前面的章节中所看到的，所使用的应用程序将被更新、修改和扩展。这意味着，如果我们想找到需要更改的地方，则需要由其他程序员（或我们）阅读代码。

这一切都将归结为一个关于金钱的问题。我们希望创建能够为用户带来附加值的软件，我们可以销售我们的应用程序。但也许更重要的是，维护应用程序代码的程序员可以高效地工作。如果他们能快速找到一个错误，他们就会花更少的时间修复它。

如果代码易于阅读和理解，程序员也将有更高的机会避免在代码中插入新的错误，从而降低修复它们的成本。

许多程序员将面临的一个问题是，他们没有时间创建他们想要的高质量代码，这是可以理解的。时间紧迫，经理不完全理解精心设计的代码的重要性，以及不耐烦的客户，这些都可能迫使程序员快速生成代码，从而导致质量下降。当然，这是一种非常短期的方法。

对于用户和将来需要维护代码的程序员来说，软件的交付速度可能会更快，但质量会更低。这很可能比一开始就制作高质量的代码更具成本效益。

还应该注意的是，如果我们用写得不好的代码开始一个项目，这个项目很可能总是包含低质量的代码，因为返回和改进所有代码的成本太高了。

如果我们做得好，编写高质量的代码，并提供用户认为高质量的软件，我们就拥有一切。

本章的其余部分将不重点介绍用户质量。这并不意味着它不是必需的，但这是一本关于编写代码的书，所以让我们看看我们如何以质量和风格做到这一点。

## 可读性

您编写的代码不仅将由计算机执行。它也将由您自己和其他人阅读。因此，编写尽可能易于阅读和理解的代码是很重要的。
我们可以遵循一些简单的规则来帮助实现代码的可读性。
明智地使用注释和文档。
在创建代码时，您需要了解您要做什么以及为什么要这样做。但是，当几个月后返回到您的代码时，这些想法是什么以及您为什么要这样写东西并不总是那么清楚。对棘手的代码行进行注释是为您未来的自己和将阅读您代码的其他人记录您的想法的一种很好的方式。
但注释也会降低代码的可读性。永远不要评论显而易见的事情--任何程序员，包括你自己，都会理解的事情。
当您查看一行代码时，您应该使用注释，并了解看到此行代码的读者需要停下来思考，然后才能理解它的作用。
注释不是我们记录代码的唯一方式。我们还可以通过巧妙地命名对象，让代码在一定程度上实现自我文档化。

· 大多数集成开发环境将允许我们单击名称，这意味着如果我们想阅读它，我们将被带到该函数。

To be able to understand what good code looks like, we must see both good and bad code. Therefore, to become a good programmer, we must read code.
Reading other people's code
As a beginner programmer, the best thing we can do is read code written by experienced developers.

作为一名初级程序员，您非常专注于让事情正常工作，而且您应该这样做。但是，当您到达那里并且您的程序正在工作时，您应该回去查看您的代码，并考虑如何提高质量。也许您不会想出经验丰富的程序员正在使用的一行解决方案，但至少您可以使用空行、缩进和合理的变量名。

在重写代码时，始终将可读性作为主要关注点。有时，您需要牺牲可读性来使代码更高效或更快，但如果这是您的主要目标，这将反映在您的代码中。
当您查看代码时，您应该始终问自己一个最基本的问题：如果是其他人编写的代码，我是否愿意阅读它？
如果答案是否定的，那么改变它，这样你就可以回答肯定了。
可读的代码很好，但代码也应该是高效的。

· 当我们谈论高效的代码时，我们可以指几种不同的东西。让我们来看看当人们谈论高效代码时可能意味着什么。
删除冗余或不必要的代码
您应该始终确保删除冗余代码。冗余代码是不影响应用程序的输出，但会被执行的代码。

## 更好的算法· 
不仅仅是像我们在这里看到的那样的语言结构也可以提高我们的应用程序的性能。选择正确的算法也会对速度和内存使用产生重大影响。
使用有效的算法
算法是一个问题的解决方案。该算法将描述完成某件事情所需的逻辑步骤。让我们看一个例子。如果我们有一个数字序列，我们希望这个序列排序，我们可以使用排序算法。我们有几个算法可供选择，所有算法都将完成任务；也就是说，排序一个序列。
我们有不止一个算法的原因是，在内存的速度和使用方面，它们或多或少是有效的。编写实现该算法的代码的难度也会有所不同。

## 复杂功能

运行这两个程序时，您不会注意到任何差异。但第二个版本在任何方面都更智能吗？它肯定占用更少的行，如果我们计算的话，也更少的字符。但我们得到了什么呢？第二个程序会运行得更快吗？对于这类应用程序来说，这是一个有点无关紧要的问题，因为程序将花费大部分时间等待用户输入数字。
可读性如何？仅仅因为第二个程序的行数和字符较少并不能使其更容易阅读和理解--恰恰相反。与第一个程序相比，即使是经验丰富的程序员也需要花费更多的时间来理解第二个程序。
对于您来说，创建类似第二个示例的东西只有一个原因，那就是作为使用语言功能的练习，但仅此而已。继续努力，使您的小程序尽可能紧凑；您将从中学到很多东西，但在编写将用于其他用途的代码时，您应该考虑可读性。

## 更聪明

· 您可以向这个函数传递一个年龄，如果这个年龄等于或大于21，它将返回true；否则，它将返回false。
这个函数是可行的，但是我们可以让它变得更智能，这次的改变将是一个进步。如果我们考虑函数内部发生的事情，我们会看到if语句将传递给该函数的年龄与21进行比较。如果if语句为真，则返回真。如果它是假的，我们返回假。这意味着我们返回与条件计算结果相同的东西，那么为什么不返回它呢？让我们来改变函数

· 这是一个聪明的变化，因为我们使代码更紧凑，更容易阅读，并摆脱了任何不必要的代码。
编程时的聪明对不同的人来说意味着不同的事情。我曾经做过一个电信项目，是用C写的。出了个问题，我被指派去修复它。但是在阅读代码的时候，我被吓坏了。我试着重现它的各个部分：

· 现在，你可能想知道为什么我在这里展示这个例子。这很难被认为是智能代码。写这篇文章的顾问可能觉得这很聪明。也许这个想法是要成为不可替代的，从顾问的角度来看，这可能是聪明的。但从拥有代码的公司的角度来看，这并不明智。我也可以指出，如果这是由于顾问方面的策略所致，那是行不通的，因为他或她已不在这家公司工作了。
无论你做什么，永远不要写这样的代码。相反，您应该记住一些编写高质量代码的最佳实践。


## 最佳实践

长度， 深度， 约定，缩进
· DRY代表“不要重复自己”，由安迪·亨特和戴夫·托马斯制定。其中规定如下：
“在一个系统内，每一个知识都必须有一个单一的、明确的、权威的表示。”
这说明我们不应该重复相同或相似的代码一次以上。当您将代码复制并粘贴到程序中的一个新位置（可能只有一些轻微的更改）时，就清楚地表明您将与这一原则相矛盾。应始终避免这种情况。
DRY的思想归结为将代码划分为可重用的小部分。我们来看一个例子。

· Pascal case类似于camel case，唯一的区别是第一个字母也是大写的。在帕斯卡的情况下，外部温度变量被命名为，温度。
Pascal case的名字来源于程序设计语言Pascal。尽管Pascal是大小写不敏感的，但由于Pascal约定使用这种样式，这种做法得到了推广。

· 但有时，Knuth的这一论点被用来推荐一种形式，即操作符开始一行，而不是结束一行。
不同的约定是大多数程序员都有自己的看法的话题。尽管如此，如果有一个合适的方法，无论是对你正在使用的语言还是你正在从事的项目，你都应该坚持使用，即使它与你认为的好的代码编写方法相矛盾。